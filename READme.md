# SOA-MAFIA
## Запуск
```
docker-compose build
docker-compose up --scale client=4 -d
```

Команда, чтобы читать логи  сервера:
```
docker logs -f soa-mafia_mafia_server_1
```

В каждом клиенте запущено консольное приложение. Необходимо подключиться к ним, чтобы писать команды:
```
docker logs <container_name> && docker attach <container_name>
```
Или для удобства можно использовать подготовленный скрипт:
```
./attach.sh <n>         # n - номер клиента, число от 1 до 4 включительно
```

После ввода имени игрока появится надпись "Enter a command:". После этого консольное приложение будет бесконечно считывать со стандартного потока ввода ваши команды и исполнять их. Чтобы получить список поддерживаемых команд, напишите "help". Вывод будет таким:
```
========================== Available commands ========================
help
join {session_name}                      join the game
vote {player_name}                       vote for a player during the day
kill {player_name}                       kill a player. (command only for mafia)
check {player_name}                      check if player is mafia. (command only for detective)
state                                    get current game state
msg {text}                               send text to chat
quit                                     quit the game session
exit                                     exit the program
```
Если какая-то команда не может быть исполнена, выводится ошибка, затем вы снова можете отправлять свои команды.

## Ход игры
Поддерживается только режим с 4 игроками: Mafia, Detective, Civilian, Civilian. Все игроки ручные. Сервер может поддерживать много сессий одновременно, но каждый клиент не может участвовать в двух играх одновременно. Если во время игра снова вызвать "join {session_name}", то игрок покинет предыдущую игру и зайдет в новую сессию.

Как только в сессии с одним именем набирается 4 игрока, игра начинается. Сначала идёт ночь.
- ночь заканчивается, когда мафия убьёт кого-то и детектив кого-то проверит (при условии, что эти игроки живы).
- день заканчивается, когда все живые игроки проголосуют. Если голоса разделяются, то никто этим днем не покидает игру, переголосований нет.

Когда начинается игра / заканчивается игра / начинается день / начинается ночь, в консоль приходит уведомление об этом ("Notification: ... ") с необходимой информацией (какая роль у игрока / кого убили прошлой ночью или прошлым днём / кто выиграл). Также в любое время можно запросить состояние игры (команда "state" из перечня выше).

## Чат
Реализован чат с помощью RabbitMQ. Пользоваться чатом можно с помощью команды "msg {text}". Сообщение text отправится всем игрокам, только если отправитель жив, сообщение отправляется днём во время игры.